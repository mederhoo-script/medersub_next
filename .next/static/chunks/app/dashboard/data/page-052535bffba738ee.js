(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5538],{723:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(8340).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},1142:(e,t,a)=>{"use strict";a.d(t,{N:()=>s});let s=(0,a(6622).createBrowserClient)("https://arbagxcbwqmquydrowjw.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFyYmFneGNid3FtcXV5ZHJvd2p3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY1NjIwMjMsImV4cCI6MjA3MjEzODAyM30.k7-oHFYulHIWs56vBzhQnClvJAlLfhyhdL7rZuauAfk")},3035:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(8340).A)("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]])},3321:(e,t,a)=>{"use strict";var s=a(4645);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},4002:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>h});var s=a(5155),r=a(2115),l=a(1142),n=a(723),i=a(6296),o=a(3035),c=a(3321),d=a(8500),u=a.n(d);let m=[{id:"MTN",name:"MTN",color:"bg-yellow-400"},{id:"AIRTEL",name:"Airtel",color:"bg-red-500"},{id:"GLO",name:"Glo",color:"bg-green-500"},{id:"9MOBILE",name:"9mobile",color:"bg-green-700"}];function h(){let e=(0,c.useRouter)(),[t,a]=(0,r.useState)(m[0]),[d,h]=(0,r.useState)([]),[g,x]=(0,r.useState)(!0),[b,p]=(0,r.useState)(null),[f,y]=(0,r.useState)(""),[N,j]=(0,r.useState)(!1),[v,w]=(0,r.useState)(null),[I,k]=(0,r.useState)([]);(0,r.useEffect)(()=>{S()},[]);let S=async()=>{x(!0);try{let e=await fetch("/api/services"),t=await e.json();console.log(t),"success"===t.status&&t.data&&t.data.dataPlans&&k(t.data.dataPlans)}catch(e){console.error("Failed to fetch services",e)}finally{x(!1)}};(0,r.useEffect)(()=>{I.length>0&&h(I.filter(e=>e.network.toUpperCase()===t.id))},[t,I]);let A=async a=>{if(a.preventDefault(),b){j(!0),w(null);try{let{data:{user:a}}=await l.N.auth.getUser();if(!a)return void e.push("/login");let s=await fetch("/api/purchase",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a.id,serviceType:"DATA",amount:Number(b.amount.toString().replace(/,/g,"")),mobileNumber:f,serviceID:b.serviceID,network:t.id,planName:b.dataPlan})}),r=await s.json();r.error?w({type:"error",msg:r.error}):(w({type:"success",msg:`Successfully purchased ${b.dataPlan}!`}),y(""),p(null),e.refresh())}catch(e){w({type:"error",msg:"Something went wrong."})}finally{j(!1)}}};return(0,s.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,s.jsx)(u(),{href:"/dashboard",className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:(0,s.jsx)(n.A,{className:"h-5 w-5 text-gray-600"})}),(0,s.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Buy Data Bundle"}),(0,s.jsx)("h1",{className:"text-2xl items-right font-bold text-blue-600 tracking-tight",children:"MEDERSUB"})]}),(0,s.jsx)("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:(0,s.jsxs)("form",{onSubmit:A,className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Network"}),(0,s.jsx)("div",{className:"grid grid-cols-4 gap-3",children:m.map(e=>(0,s.jsxs)("button",{type:"button",onClick:()=>{a(e),p(null)},className:`flex flex-col items-center p-3 rounded-xl border-2 transition-all ${t.id===e.id?"border-green-600 bg-green-50":"border-transparent bg-gray-50 hover:bg-gray-100"}`,children:[(0,s.jsx)("div",{className:`h-8 w-8 rounded-full ${e.color} mb-2`}),(0,s.jsx)("span",{className:"text-xs font-semibold",children:e.name})]},e.id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Select Plan"}),g&&(0,s.jsx)(i.A,{className:"h-3 w-3 animate-spin text-gray-400"})]}),(0,s.jsxs)("select",{required:!0,value:b?.serviceID||"",onChange:e=>{p(d.find(t=>t.serviceID===e.target.value)||null)},disabled:g,className:"w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-green-500 bg-white",children:[(0,s.jsx)("option",{value:"",children:g?"Loading plans...":"-- Choose Plan --"}),d.map((e,t)=>{let a=function(e){let t=e.toLowerCase().replace(/\s/g,"").match(/(\d+(?:\.\d+)?)(mb|gb|tb)/);if(!t)return 0;let a=parseFloat(t[1]),s=t[2],r=a;return("mb"===s?r=a/1024:"tb"===s&&(r=1024*a),r<=1)?10:r<=3?20:r<=5?30:r<=10?50:100}(e.dataPlan),r=Number(e.amount.toString().replace(/,/g,""))+a;return(0,s.jsxs)("option",{value:e.serviceID,children:[e.dataPlan," - â‚¦",r," - ",e.validity," - ",e.dataType]},`${e.serviceID}-${t}`)})]}),0===d.length&&!g&&(0,s.jsxs)("p",{className:"text-xs text-red-500 mt-1",children:["No plans available for ",t.name,"."]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(o.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,s.jsx)("input",{type:"tel",required:!0,value:f,onChange:e=>y(e.target.value),className:"w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"08012345678"})]})]}),v&&(0,s.jsx)("div",{className:`p-4 rounded-xl text-sm ${"success"===v.type?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:v.msg}),(0,s.jsx)("button",{type:"submit",disabled:N||!b,className:"w-full py-4 bg-green-600 text-white rounded-xl font-bold text-lg hover:bg-green-700 transition-colors disabled:opacity-70 flex items-center justify-center gap-2",children:N?(0,s.jsx)(i.A,{className:"h-5 w-5 animate-spin"}):"Buy Now"})]})})]})}},5513:(e,t,a)=>{Promise.resolve().then(a.bind(a,4002))},6296:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(8340).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])}},e=>{e.O(0,[8500,4293,8441,8928,7358],()=>e(e.s=5513)),_N_E=e.O()}]);