(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4267],{723:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(8340).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},1142:(e,t,s)=>{"use strict";s.d(t,{N:()=>a});let a=(0,s(6622).createBrowserClient)("https://arbagxcbwqmquydrowjw.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFyYmFneGNid3FtcXV5ZHJvd2p3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY1NjIwMjMsImV4cCI6MjA3MjEzODAyM30.k7-oHFYulHIWs56vBzhQnClvJAlLfhyhdL7rZuauAfk")},2651:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(8340).A)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},3014:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var a=s(5155),r=s(2115),l=s(1142),i=s(723),n=s(9892),c=s(6296),o=s(2651),d=s(3321),u=s(8500),m=s.n(u);let h=[{id:"GOTV",name:"GOtv",color:"bg-green-500",serviceIdPrefix:"GOTV"},{id:"DSTV",name:"DStv",color:"bg-blue-500",serviceIdPrefix:"DSTV"},{id:"STARTIMES",name:"StarTimes",color:"bg-orange-500",serviceIdPrefix:"STARTIMES"}];function b(){let e=(0,d.useRouter)(),[t,s]=(0,r.useState)(h[0]),[u,b]=(0,r.useState)(""),[x,g]=(0,r.useState)(!1),[p,y]=(0,r.useState)(null),[f,v]=(0,r.useState)(null),[N,j]=(0,r.useState)(!1),[S,w]=(0,r.useState)(null),[I,C]=(0,r.useState)([]),[k,P]=(0,r.useState)(!0);(0,r.useEffect)(()=>{A()},[]);let A=async()=>{P(!0);try{let e=await fetch("/api/services"),t=await e.json();"success"===t.status&&t.data&&t.data.cablePlans&&C(t.data.cablePlans)}catch(e){console.error("Failed to fetch services",e)}finally{P(!1)}},O=I.filter(e=>e.cable===t.id),T=async()=>{if(!u)return;g(!0),y(null),w(null);let e=O[0]?.serviceID||"1";try{let t=await fetch("/api/cable/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({serviceID:e,iucNum:u})}),s=await t.json();s.success?(y(s.data.customerName||"Customer"),w({type:"success",msg:`Verified: ${s.data.customerName}`})):w({type:"error",msg:s.error||"Could not verify IUC number"})}catch(e){w({type:"error",msg:"Validation failed"})}finally{g(!1)}},J=async s=>{if(s.preventDefault(),!f||!p)return void w({type:"error",msg:"Please validate IUC and select a plan"});j(!0),w(null);try{let{data:{user:s}}=await l.N.auth.getUser();if(!s)return void e.push("/login");let a=await fetch("/api/purchase",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:s.id,serviceType:"CABLE",amount:Number(f.amount.toString().replace(/,/g,"")),mobileNumber:u,serviceID:f.serviceID,network:t.id,planName:f.cablePlan})}),r=await a.json();r.error?w({type:"error",msg:r.error}):(w({type:"success",msg:"Subscription successful!"}),b(""),y(null),v(null),e.refresh())}catch(e){w({type:"error",msg:"Something went wrong."})}finally{j(!1)}};return(0,a.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,a.jsx)(m(),{href:"/dashboard",className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:(0,a.jsx)(i.A,{className:"h-5 w-5 text-gray-600"})}),(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Cable TV"})]}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Provider"}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-3",children:h.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>{s(e),y(null),v(null),w(null)},className:`flex flex-col items-center p-3 rounded-xl border-2 transition-all ${t.id===e.id?"border-blue-600 bg-blue-50":"border-transparent bg-gray-50 hover:bg-gray-100"}`,children:[(0,a.jsx)("div",{className:`h-8 w-8 rounded-full ${e.color} mb-2`}),(0,a.jsx)("span",{className:"text-xs font-semibold",children:e.name})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Smart Card / IUC Number"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(n.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,a.jsx)("input",{type:"text",value:u,onChange:e=>{b(e.target.value),y(null)},className:"w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter number"})]}),(0,a.jsx)("button",{type:"button",onClick:T,disabled:x||!u,className:"px-4 py-2 bg-gray-900 text-white rounded-xl text-sm font-medium hover:bg-gray-800 disabled:opacity-50",children:x?(0,a.jsx)(c.A,{className:"h-4 w-4 animate-spin"}):"Verify"})]}),p&&(0,a.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-sm text-green-600 bg-green-50 p-2 rounded-lg",children:[(0,a.jsx)(o.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"font-medium",children:p})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Plan"}),(0,a.jsxs)("select",{value:f?JSON.stringify(f):"",onChange:e=>v(e.target.value?JSON.parse(e.target.value):null),disabled:k,className:"w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[(0,a.jsx)("option",{value:"",children:k?"Loading plans...":"-- Choose Package --"}),O.map(e=>(0,a.jsxs)("option",{value:JSON.stringify(e),children:[e.cablePlan," - â‚¦",Number(e.amount.toString().replace(/,/g,"")).toLocaleString()]},e.serviceID))]})]}),S&&(0,a.jsx)("div",{className:`p-4 rounded-xl text-sm ${"success"===S.type?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:S.msg}),(0,a.jsx)("button",{type:"button",onClick:J,disabled:N||!f||!p,className:"w-full py-4 bg-blue-600 text-white rounded-xl font-bold text-lg hover:bg-blue-700 transition-colors disabled:opacity-70 flex items-center justify-center gap-2",children:N?(0,a.jsx)(c.A,{className:"h-5 w-5 animate-spin"}):"Pay Now"})]})})]})}},3321:(e,t,s)=>{"use strict";var a=s(4645);s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},6296:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(8340).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},7516:(e,t,s)=>{Promise.resolve().then(s.bind(s,3014))},9892:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(8340).A)("tv",[["path",{d:"m17 2-5 5-5-5",key:"16satq"}],["rect",{width:"20",height:"15",x:"2",y:"7",rx:"2",key:"1e6viu"}]])}},e=>{e.O(0,[8500,4293,8441,8928,7358],()=>e(e.s=7516)),_N_E=e.O()}]);