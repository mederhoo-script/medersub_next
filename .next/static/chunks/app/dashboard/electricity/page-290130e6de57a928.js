(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6187],{723:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(8340).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},1142:(e,t,s)=>{"use strict";s.d(t,{N:()=>a});let a=(0,s(6622).createBrowserClient)("https://arbagxcbwqmquydrowjw.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFyYmFneGNid3FtcXV5ZHJvd2p3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY1NjIwMjMsImV4cCI6MjA3MjEzODAyM30.k7-oHFYulHIWs56vBzhQnClvJAlLfhyhdL7rZuauAfk")},2472:(e,t,s)=>{Promise.resolve().then(s.bind(s,4241))},2651:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(8340).A)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},3321:(e,t,s)=>{"use strict";var a=s(4645);s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},3961:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(8340).A)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]])},4241:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var a=s(5155),r=s(2115),l=s(1142),i=s(723),n=s(3961),c=s(6296),d=s(2651),o=s(3321),u=s(8500),m=s.n(u);let y=[{id:1,name:"Prepaid"},{id:2,name:"Postpaid"}];function x(){let e,t=(0,o.useRouter)(),[s,u]=(0,r.useState)([]),[x,h]=(0,r.useState)(!0),[p,g]=(0,r.useState)(null),[b,f]=(0,r.useState)(y[0]),[N,v]=(0,r.useState)(""),[j,w]=(0,r.useState)(""),[I,S]=(0,r.useState)(!1),[k,A]=(0,r.useState)(null),[C,P]=(0,r.useState)(!1),[M,D]=(0,r.useState)(null);(0,r.useEffect)(()=>{E()},[]);let E=async()=>{h(!0);try{let e=await fetch("/api/services"),t=await e.json();"success"===t.status&&t.data&&t.data.electricity&&(u(t.data.electricity),t.data.electricity.length>0&&g(t.data.electricity[0]))}catch(e){console.error("Failed to fetch services",e)}finally{h(!1)}},J=async()=>{if(N&&p){S(!0),A(null),D(null);try{let e=await fetch("/api/electricity/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({serviceID:p.serviceID,meterNum:N,meterType:b.id})}),t=await e.json();t.success?(A(t.data.customerName||"Customer"),D({type:"success",msg:`Verified: ${t.data.customerName}`})):D({type:"error",msg:t.error||"Could not verify Meter number"})}catch(e){D({type:"error",msg:"Validation failed"})}finally{S(!1)}}},T=async e=>{if(e.preventDefault(),!k)return void D({type:"error",msg:"Please validate Meter Number first"});P(!0),D(null);try{let{data:{user:e}}=await l.N.auth.getUser();if(!e)return void t.push("/login");let s=await fetch("/api/purchase",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.id,serviceType:"ELECTRICITY",amount:Number(j.replace(/,/g,"")),mobileNumber:N,serviceID:p.serviceID,network:p.disco,meterType:b.id})}),a=await s.json();a.error?D({type:"error",msg:a.error}):(D({type:"success",msg:"Electricity Payment successful!"}),v(""),w(""),A(null),t.refresh())}catch(e){D({type:"error",msg:"Something went wrong."})}finally{P(!1)}};return(0,a.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,a.jsx)(m(),{href:"/dashboard",className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:(0,a.jsx)(i.A,{className:"h-5 w-5 text-gray-600"})}),(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Pay Electricity"})]}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:(0,a.jsxs)("form",{onSubmit:T,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Distribution Company"}),x?(0,a.jsx)("div",{className:"w-full text-center py-4 text-gray-500 text-sm",children:"Loading Discos..."}):(0,a.jsx)("select",{value:p?.serviceID||"",onChange:e=>{g(s.find(t=>t.serviceID===e.target.value)),A(null)},className:"w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-yellow-500 bg-white",children:s.map(e=>(0,a.jsx)("option",{value:e.serviceID,children:e.disco},e.serviceID))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Meter Type"}),(0,a.jsx)("div",{className:"flex p-1 bg-gray-100 rounded-xl",children:y.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{f(e),A(null)},className:`flex-1 py-2 text-sm font-medium rounded-lg transition-all ${b.id===e.id?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:e.name},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Meter Number"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(n.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,a.jsx)("input",{type:"text",value:N,onChange:e=>{v(e.target.value),A(null)},className:"w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"Enter Meter Number"})]}),(0,a.jsx)("button",{type:"button",onClick:J,disabled:I||!N||!p,className:"px-4 py-2 bg-gray-900 text-white rounded-xl text-sm font-medium hover:bg-gray-800 disabled:opacity-50",children:I?(0,a.jsx)(c.A,{className:"h-4 w-4 animate-spin"}):"Verify"})]}),k&&(0,a.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-sm text-green-600 bg-green-50 p-2 rounded-lg",children:[(0,a.jsx)(d.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"font-medium",children:k})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount (₦)"}),(0,a.jsx)("input",{type:"number",required:!0,min:"100",value:j,onChange:e=>w(e.target.value),className:"w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-yellow-500 text-lg font-semibold",placeholder:"1000"}),j&&(0,a.jsxs)("div",{className:"mt-2 text-right",children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"You pay: "}),(0,a.jsxs)("span",{className:"text-lg font-bold text-green-600",children:["₦",(!(e=Number(j.replace(/,/g,"")))?0:e-.002*e).toLocaleString()]})]})]}),M&&(0,a.jsx)("div",{className:`p-4 rounded-xl text-sm ${"success"===M.type?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:M.msg}),(0,a.jsx)("button",{type:"submit",disabled:C||!k,className:"w-full py-4 bg-yellow-500 text-black rounded-xl font-bold text-lg hover:bg-yellow-400 transition-colors disabled:opacity-70 flex items-center justify-center gap-2",children:C?(0,a.jsx)(c.A,{className:"h-5 w-5 animate-spin"}):"Pay Bill"})]})})]})}},6296:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(8340).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])}},e=>{e.O(0,[8500,4293,8441,8928,7358],()=>e(e.s=2472)),_N_E=e.O()}]);