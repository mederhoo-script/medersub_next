{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/mederhoo/vtu/vtu-platform/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n\n// Client for public access (optional, if needed for client-side)\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey)\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM;AAGC,MAAM,WAAW,IAAA,gMAAY,EAAC,aAAa"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///home/mederhoo/vtu/vtu-platform/lib/inlomax.ts"],"sourcesContent":["import axios from 'axios';\n\nconst INLOMAX_API_KEY = process.env.INLOMAX_API_KEY;\nconst BASE_URL = 'https://inlomax.com/api';\n\nconst api = axios.create({\n    baseURL: BASE_URL,\n    headers: {\n        'Authorization': `Token ${INLOMAX_API_KEY}`,\n        'Content-Type': 'application/json',\n    },\n});\n\nexport interface GenericResponse {\n    status: string;\n    message: string;\n}\n\nexport const inlomax = {\n    getBalance: async () => {\n        try {\n            const { data } = await api.get('/balance');\n            return data;\n        } catch (error: any) {\n            console.error('Inlomax Balance Error:', error.response?.data || error.message);\n            return { status: 'error', message: 'Failed to fetch balance' };\n        }\n    },\n\n    getServices: async () => {\n        try {\n            const { data } = await api.get('/services');\n            return data;\n        } catch (error: any) {\n            console.error('Inlomax Services Error:', error.response?.data || error.message);\n            return { status: 'error', message: 'Failed to fetch services' };\n        }\n    },\n\n    purchaseAirtime: async (mobileNumber: string, amount: number, serviceID: string) => {\n        try {\n            const { data } = await api.post('/airtime', { mobileNumber, amount, serviceID });\n            return data;\n        } catch (error: any) {\n            console.error('Inlomax Airtime Error:', error.response?.data || error.message);\n            // Return the error response properly\n            return error.response?.data || { status: 'error', message: 'Failed to purchase airtime' };\n        }\n    },\n\n    purchaseData: async (mobileNumber: string, serviceID: string) => {\n        try {\n            const { data } = await api.post('/data', { mobileNumber, serviceID });\n            return data;\n        } catch (error: any) {\n            console.error('Inlomax Data Error:', error.response?.data || error.message);\n            return error.response?.data || { status: 'error', message: 'Failed to purchase data' };\n        }\n    },\n\n    validateCable: async (iucNum: string, serviceID: string) => {\n        try {\n            const { data } = await api.post('/validatecable', { iucNum, serviceID });\n            return data;\n        } catch (error: any) {\n            return error.response?.data || { status: 'error', message: 'Failed to validate cable' };\n        }\n    },\n\n    purchaseCable: async (iucNum: string, serviceID: string) => {\n        try {\n            const { data } = await api.post('/subcable', { iucNum, serviceID });\n            return data;\n        } catch (error: any) {\n            return error.response?.data || { status: 'error', message: 'Failed to subscribe cable' };\n        }\n    },\n\n    validateMeter: async (meterNum: string, serviceID: string, meterType: number) => {\n        try {\n            const { data } = await api.post('/validatemeter', { meterNum, serviceID, meterType });\n            return data;\n        } catch (error: any) {\n            return error.response?.data || { status: 'error', message: 'Failed to validate meter' };\n        }\n    },\n\n    payElectricity: async (meterNum: string, serviceID: string, meterType: number, amount: number) => {\n        try {\n            const { data } = await api.post('/payelectric', { meterNum, serviceID, meterType, amount });\n            return data;\n        } catch (error: any) {\n            return error.response?.data || { status: 'error', message: 'Failed to pay electricity' };\n        }\n    },\n\n    getTransaction: async (reference: string) => {\n        try {\n            const { data } = await api.post('/transaction', { reference });\n            return data;\n        } catch (error: any) {\n            return error.response?.data || { status: 'error', message: 'Failed to fetch transaction' };\n        }\n    }\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 212, "column": 0}, "map": {"version":3,"sources":["file:///home/mederhoo/vtu/vtu-platform/app/api/purchase/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { supabaseAdmin } from '@/lib/supabase';\nimport { inlomax } from '@/lib/inlomax';\n\nexport async function POST(req: Request) {\n    try {\n        const { userId, serviceType, amount, mobileNumber, serviceID, network } = await req.json();\n\n        if (!userId || !amount || !mobileNumber || !serviceID) {\n            return NextResponse.json({ error: 'Missing required fields' }, { status: 400 });\n        }\n\n        // 1. Check User Balance\n        const { data: user, error: userError } = await supabaseAdmin\n            .from('profiles')\n            .select('balance')\n            .eq('id', userId)\n            .single();\n\n        if (userError || !user) {\n            return NextResponse.json({ error: 'User not found' }, { status: 404 });\n        }\n\n        if (user.balance < amount) {\n            return NextResponse.json({ error: 'Insufficient balance' }, { status: 400 });\n        }\n\n        // 2. Call Inlomax API\n        let apiResponse;\n        if (serviceType === 'AIRTIME') {\n            apiResponse = await inlomax.purchaseAirtime(mobileNumber, amount, serviceID);\n        } else if (serviceType === 'DATA') {\n            apiResponse = await inlomax.purchaseData(mobileNumber, serviceID);\n        } else {\n            return NextResponse.json({ error: 'Invalid service type' }, { status: 400 });\n        }\n\n        if (apiResponse.status !== 'success') {\n            return NextResponse.json({ error: apiResponse.message || 'Provider failed' }, { status: 502 });\n        }\n\n        // 3. Deduct Balance\n        const newBalance = user.balance - Number(amount);\n        const { error: updateError } = await supabaseAdmin\n            .from('profiles')\n            .update({ balance: newBalance })\n            .eq('id', userId);\n\n        if (updateError) {\n            // Critical: Money wasn't deducted but service given. \n            // In prod, log this heavily.\n            console.error('CRITICAL: Failed to deduct balance after successful purchase', userId, amount);\n        }\n\n        // 4. Record Transaction\n        await supabaseAdmin.from('transactions').insert({\n            user_id: userId,\n            type: 'PURCHASE',\n            amount: Number(amount),\n            service_type: serviceType,\n            status: 'SUCCESS',\n            reference: apiResponse.data?.reference || `REF-${Date.now()}`,\n            meta: {\n                mobile: mobileNumber,\n                network: network,\n                provider_ref: apiResponse.data?.reference\n            }\n        });\n\n        return NextResponse.json({ success: true, newBalance, message: apiResponse.message });\n\n    } catch (err: any) {\n        console.error('Purchase Error:', err);\n        return NextResponse.json({ error: err.message || 'Internal Server Error' }, { status: 500 });\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,GAAY;IACnC,IAAI;QACA,MAAM,EAAE,MAAM,EAAE,WAAW,EAAE,MAAM,EAAE,YAAY,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,MAAM,IAAI,IAAI;QAExF,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,gBAAgB,CAAC,WAAW;YACnD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QACjF;QAEA,wBAAwB;QACxB,MAAM,EAAE,MAAM,IAAI,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,kIAAa,CACvD,IAAI,CAAC,YACL,MAAM,CAAC,WACP,EAAE,CAAC,MAAM,QACT,MAAM;QAEX,IAAI,aAAa,CAAC,MAAM;YACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,IAAI,KAAK,OAAO,GAAG,QAAQ;YACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuB,GAAG;gBAAE,QAAQ;YAAI;QAC9E;QAEA,sBAAsB;QACtB,IAAI;QACJ,IAAI,gBAAgB,WAAW;YAC3B,cAAc,MAAM,2HAAO,CAAC,eAAe,CAAC,cAAc,QAAQ;QACtE,OAAO,IAAI,gBAAgB,QAAQ;YAC/B,cAAc,MAAM,2HAAO,CAAC,YAAY,CAAC,cAAc;QAC3D,OAAO;YACH,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuB,GAAG;gBAAE,QAAQ;YAAI;QAC9E;QAEA,IAAI,YAAY,MAAM,KAAK,WAAW;YAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,YAAY,OAAO,IAAI;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QAChG;QAEA,oBAAoB;QACpB,MAAM,aAAa,KAAK,OAAO,GAAG,OAAO;QACzC,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,kIAAa,CAC7C,IAAI,CAAC,YACL,MAAM,CAAC;YAAE,SAAS;QAAW,GAC7B,EAAE,CAAC,MAAM;QAEd,IAAI,aAAa;YACb,sDAAsD;YACtD,6BAA6B;YAC7B,QAAQ,KAAK,CAAC,gEAAgE,QAAQ;QAC1F;QAEA,wBAAwB;QACxB,MAAM,kIAAa,CAAC,IAAI,CAAC,gBAAgB,MAAM,CAAC;YAC5C,SAAS;YACT,MAAM;YACN,QAAQ,OAAO;YACf,cAAc;YACd,QAAQ;YACR,WAAW,YAAY,IAAI,EAAE,aAAa,CAAC,IAAI,EAAE,KAAK,GAAG,IAAI;YAC7D,MAAM;gBACF,QAAQ;gBACR,SAAS;gBACT,cAAc,YAAY,IAAI,EAAE;YACpC;QACJ;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM;YAAY,SAAS,YAAY,OAAO;QAAC;IAEvF,EAAE,OAAO,KAAU;QACf,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,IAAI,OAAO,IAAI;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC9F;AACJ"}}]
}